This section presents benchmarks and tests that demonstrate 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Deployment productivity}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\assign{Ben}

Benchmark the time to build and deploy a stack from scratch vs. with a build cache.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Developer productivity}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\assign{Ben}

Squashfs deployment reduces configuration and compilation times compared to serving the same stack on a shared filesystem;

Benchmark configuration time and build time with the same stack stored in different locations:
\begin{itemize}
    \item mounted with squashfs-run
    \item in memory, i.e. \lstinline|/dev/shm|
    \item on scratch.
\end{itemize}

For the following:
\begin{itemize}
    \item simple hello world
    \item medium complexity application (Arbor)
    \item complex application, e.g. DLA-F
\end{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Overheads}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\assign{Ben}

Quantify the memory overheads and affect on job startup time of mounting squashfs images on compute nodes at the start of SLURM jobs;

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Benchmarks and Applications}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\assign{JG (SPH-EXA), Antonk}

Micro-benchmarks and application benchmarks that demonstrate equivalent performance to applications compiled with CPE on the same system.

\todo{pick a couple of applications/micro-benchmarks to evaluate.}

benchmarks:
\begin{itemize}
    \item OSU benchmarks \assign{Ben Theo}
    \item SPH-EXA \assign{JG}
    \item \dots other?
\end{itemize}

% \subsubsection{SPH-EXA}
% \label{sec:sphexa}
%{{{ sphexa results
The SPH-EXA\footnote{\url{https://github.com/unibas-dmi-hpc/SPH-EXA}} project is a multidisciplinary effort that looks to scale the Smoothed Particle Hydrodynamics (SPH) method to enable exascale hydrodynamics simulations for the fields of Cosmology and Astrophysics. 
Figure \ref{fig:gpu-A100-best} shows the performance obtained for the MPI+OpenMP+CUDA and MPI+OpenMP+HIP codes executing the Sedov--Taylor\footnote{\url{https://doi.org/10.48550/arxiv.2202.02840}} blast wave explosion test case with $400^3$ particles per gpu and $40$ time-steps.
The results show that the squashfs-based executables delivers competitive performance with that of the cpe based CPU executables on both NVIDIA A100 and AMD MI200 gpus.\\
%}}}
%{{{ \section{NVIDIA A100 gpus}
\begin{tikzpicture}[scale=0.45]
\label{fig:gpu-A100-best}
\begin{axis} [
    ymin = 0,
    ybar, bar width = 3pt, symbolic x coords={1,2,3,4,6,8,9,12,16},
    xtick = data, grid=major, % legend pos=outer north east,
    xlabel=Number of NVIDIA A100 gpus, ylabel={Iteration throughput per min},
    title={SPH-EXA Weak Scaling (higher is better)},
]
\addplot[fill=green!30!white] table[x=num_tasks, y=it_throughput_per_min] {./data/sphexa/tbl/run-report-A100-64M-CPE-cpe2212.tbl};
\addlegendentry{cpe/22.12}
%
\addplot[fill=green] table[x=num_tasks, y=it_throughput_per_min] {./data/sphexa/tbl/run-report-A100-64M-SQFS-cpe2208.tbl};
\addlegendentry{uenv/22.08}
%
\addplot[fill=green] table[x=num_tasks, y=it_throughput_per_min] {./data/sphexa/tbl/run-report-A100-64M-SQFS-cpe2212.tbl};
\addlegendentry{uenv/22.12}
\end{axis}
\end{tikzpicture}
% \captionof{figure}{your Caption}
%}}}
%{{{ \section{AMD MI200 gpus}
\begin{tikzpicture}[scale=0.45]
\label{fig:gpu-MI200-best}
\begin{axis} [
    ymin = 0,
    ybar, bar width = 3pt,    
    x = 0.4cm, % space between bars
    symbolic x coords={1,2,3,4,5,6,7,8,10,12,14,16,20,24,28,32,40,48,56},
    xtick = data, grid=major, % legend pos=outer north east,
    xlabel=Number of AMD MI200 gpus,
    ylabel={Iteration throughput per min},
    title={SPH-EXA Weak Scaling (higher is better)},
]
%
\addplot[fill=red!30!white] table[x=num_tasks, y=it_throughput_per_min] {./data/sphexa/tbl/run-report-MI200-64M-CPE-cpe2212.tbl};
\addlegendentry{cpe/22.12}
%
\addplot[fill=red] table[x=num_tasks, y=it_throughput_per_min] {./data/sphexa/tbl/run-report-MI200-64M-SQFS-cpe2212.tbl};
\addlegendentry{uenv/22.12}
\end{axis} 
\end{tikzpicture}
%}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\subsection{Tools}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\assign{JG}

\begin{itemize}
    \item demonstrate DDT
    \item demonstrate a profiler?
\end{itemize}

\subsubsection{Performance tools}
% {{{ nvidia nsys
\begin{table}
\centering
\caption{}
\pgfplotstabletypeset[
    precision=0,
    every head row/.style={before row=\toprule,after row=\midrule},
    col sep=space, columns={num-tasks, H2D-MB-max, D2H-MB-max, D2D-MB-max},
    columns/num-tasks/.style={column name=A100},
    columns/H2D-MB-max/.style={column name=H2D},
    columns/D2H-MB-max/.style={column name=D2H},
    columns/D2D-MB-max/.style={column name=D2D},
]
{./data/sphexa/tbl/run-report-A100-64M-SQFS-cpe2302-NSYS.tbl}
% \captionof{table}{MB}
\label{table:nsys-A100}
\end{table}

Table \ref{table:nsys-A100} shows the amount of CUDA memory copies (in MB) reported by NVIDIA performance tool (Nsight Systems) for the Sedov--Taylor test case.
The transfer sizes (in MB) for Host to Device (H2D), Device to Host (D2H) and Device to Device (D2D) for simulations with uenv and without uenv (cpe only) are equal, demonstrating that the performance tool can be used in both scenarios.
% }}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\section{Future work}
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

We will discuss collaboration with HPE to provide Cray-MPICH and other HPE software packages via spack stacks, and how we plan to deliver software for the large Grace-Hopper scale out in the second half of 2023 at CSCS.

%%% Local Variables:
%%% TeX-master: "paper"
%%% End:
